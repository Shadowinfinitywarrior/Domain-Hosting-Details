<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Domain Lookup</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAhxVxDtmMGk2Fo3x2wexhsaOFBQXwZoqc&callback=initMap" async defer></script>
    <style>
        /* Style for the map */
        #map {
            height: 400px; /* Set a height for the map */
            width: 100%; /* Full width */
            display: none; /* Hide by default */
            margin-top: 20px; /* Space from other content */
        }
    </style>
</head>
<body>
    <!-- Background Video -->
    <video autoplay muted loop id="background-video">
        <source src="{{ url_for('static', filename='bg_video.mp4') }}" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <!-- Content Wrapper to place over video -->
    <div class="content-wrapper">
        <h1>Domain Lookup Tool</h1>
        <form id="domainForm" action="/lookup" method="post">
            <input type="text" name="domain" placeholder="Enter domain" required>
            <button type="submit">Lookup</button>
        </form>
        <div id="loader" class="spinner"></div>
        <div id="results"></div>

        <!-- Button to view on map -->
        <button id="mapViewButton" style="display: none;">View on Map</button>
        
        <!-- Map div -->
        <div id="map"></div>
    </div>

    <script>
        const form = document.querySelector('#domainForm');
        const loader = document.getElementById('loader');
        const resultsDiv = document.getElementById('results');
        const mapViewButton = document.getElementById('mapViewButton');
        let map; // Variable to hold the map instance

        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            loader.style.display = 'block'; // Show loader
            resultsDiv.innerHTML = ''; // Clear previous results
            mapViewButton.style.display = 'none'; // Hide map view button
            document.getElementById('map').style.display = 'none'; // Hide the map

            const formData = new FormData(form);
            const response = await fetch('/lookup', {
                method: 'POST',
                body: formData,
            });
            const result = await response.json();
            loader.style.display = 'none'; // Hide loader when data is fetched

            // Check for errors
            if (result.error) {
                resultsDiv.innerHTML = `<div class="error">${result.error}</div>`;
                return;
            }

            // Display results
            const domainInfo = document.createElement('div');
            domainInfo.className = 'result-item';
            domainInfo.innerHTML = `<h3>Domain Info:</h3><p>${result.domain_info}</p>`;
            
            const ipInfo = document.createElement('div');
            ipInfo.className = 'result-item';
            ipInfo.innerHTML = `<h3>IP Address:</h3><p>${result.ip}</p>`;
            
            const nameserversInfo = document.createElement('div');
            nameserversInfo.className = 'result-item';
            nameserversInfo.innerHTML = `<h3>Nameservers:</h3><p>${result.nameservers.join(', ')}</p>`;
            
            const ipDetails = document.createElement('div');
            ipDetails.className = 'result-item';
            ipDetails.innerHTML = `<h3>IP Information:</h3><pre>${JSON.stringify(result.ip_info, null, 2)}</pre>`;
            
            resultsDiv.append(domainInfo, ipInfo, nameserversInfo, ipDetails);

            // Show map view button if location data is available
            if (result.ip_info && result.ip_info.loc) {
                const [latitude, longitude] = result.ip_info.loc.split(',');
                mapViewButton.style.display = 'block'; // Show the button

                // Add event listener to open the map
                mapViewButton.onclick = () => {
                    // Show the map and initialize it
                    document.getElementById('map').style.display = 'block';
                    initMap(latitude, longitude);
                };
            }
        });

        // Initialize map function
        function initMap(lat, lng) {
            const location = { lat: parseFloat(lat), lng: parseFloat(lng) };
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 15,
                center: location,
            });
            new google.maps.Marker({
                position: location,
                map: map,
            });
        }
    </script>
</body>
</html>
